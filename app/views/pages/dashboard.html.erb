
<div style="display: none;">
<%@timevalues = Exchangetimevalue.where("platform_id = '1' AND crypto_id = '1'").last(300) %>
<%@timevalues1 = Exchangetimevalue.where("platform_id = '2' AND crypto_id = '1'").last(300)%>
<%@alltimevalues = []%>
<%@alltimevalues1 = []%>
<%@min = @timevalues[0].euro.to_f%>
<%@max = @timevalues[0].euro.to_f%>
<%@min1 = @timevalues1[0].euro.to_f%>
<%@max1 = @timevalues1[0].euro.to_f%>
<%@timevalues.each_with_index do |timeval, ind|%>
  <%=  @alltimevalues << [timeval.created_at.to_time.to_i * 1000,timeval.euro]%>
  <%  if timeval.euro < @min%>
    <%=    @min = timeval.euro.to_f%>
  <% end%>
  <% if timeval.euro > @max%>
    <%=    @max = timeval.euro.to_f%>
  <% end%>

<%end%>

<%@timevalues1.each_with_index do |timeval, ind|%>
  <%=  @alltimevalues1 << [timeval.created_at.to_time.to_i * 1000,timeval.euro]%>
  <%  if timeval.euro < @min1%>
    <%=    @min1 = timeval.euro.to_f%>
  <% end%>
  <% if timeval.euro > @max1%>
    <%=    @max1 = timeval.euro.to_f%>
  <% end%>

<%end%>


  <div id="demochartline"><%= @alltimevalues%></div>
  <div id="demochartline1"><%= @alltimevalues1%></div>
  <div id="demochartline2"><%= @alltimevalues2%></div>

  <div id="minval"><%= @min%></div>
  <div id="maxval"><%= @max%></div>

  <div id="minval1"><%= @min1%></div>
  <div id="maxval1"><%= @max1%></div>

</div>



<div class="container">
  <div class='card'>
                                    <div class="card-top">
                                        <h4 class="card-title">Multi Axes Line Chart</h4>
                                    </div>
                                    <div class='card-content'>
                                       <div class="flot-chart">
                                <div class="flot-chart-content" id="flot-line-chart-multi00"></div>
                            </div>

                                    </div>
                                </div>


  <div class="row">
    <% if @favorites %>
      <% @favorites.each do |favorite| %>
        <div class="col-md-6 col-lg-4 col-sm-12">
          <%= link_to crypto_path(favorite.crypto) do %>
          <div class="card-dashbord-favorite">
            <div class="row">
              <div class="col-md-6">
                <div class="card-dashbord-favorite-image">
                  <img src="<%= favorite.crypto.photo_url %>", width="100">
                </div>
              </div>
              <div class="col-md-6">
                <div class="card-favorite-content">
                  <% vp1 = Exchangetimevalue.where(crypto: favorite.crypto, platform: Platform.find(favorite.platform1.to_i)).last.euro %>
                  <% vp2 = Exchangetimevalue.where(crypto: favorite.crypto, platform: Platform.find(favorite.platform2.to_i)).last.euro %>
                  <% if vp1 > vp2 %>
                    <div style="margin-bottom: 10px;">
                      <h4 style="color: green"><%= vp1 %> €</h4>
                      <span><%= Platform.find(favorite.platform1.to_i).name %></span>
                    </div>
                    <div style="margin-top: 10px;">
                      <h4 style="color: #e8272a"><%= vp2 %> €</h4>
                      <span><%= Platform.find(favorite.platform2.to_i).name %></span>
                    </div>
                  <% else %>
                    <div style="margin-bottom: 10px;">
                      <h4 style="color: #e8272a"><%= vp1 %> €</h4>
                      <span><%= Platform.find(favorite.platform1.to_i).name %></span>
                    </div>
                    <div style="margin-top: 10px;">
                      <h4 style="color: green"><%= vp2 %> €</h4>
                      <span><%= Platform.find(favorite.platform2.to_i).name %></span>
                    </div>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
          <% end %>
        </div>
      <% end %>
    <% end %>
  </div>
</div>



<%= content_for(:after_js) do %>
  <script type="text/javascript">

    var datas = document.getElementById("demochartline");
    var datas1 = document.getElementById("demochartline1");

    var min = document.getElementById("minval");
    var max = document.getElementById("maxval");

    var min1 = document.getElementById("minval1");
    var max1 = document.getElementById("maxval1");

    min = min.innerHTML;
    max = max.innerHTML;

    min1 = min1.innerHTML;
    max1 = max1.innerHTML;

    datas = datas.innerHTML;
    datas1 = datas1.innerHTML;

    min = JSON.parse(min);
    max = JSON.parse(max);

    min1 = JSON.parse(min1);
    max1 = JSON.parse(max1);

    datas = JSON.parse(datas);
    datas1 = JSON.parse(datas1);


    if (min1 < min)
    {
      min = min1;
    }

    if (max1 > max)
    {
      max = max1;
    }


    $(function() {
    var oilprices = datas
    var exchangerates = datas1

    function euroFormatter(v, axis) {
        return v.toFixed(axis);
    }

    function doPlot(position) {
        $.plot($("#flot-line-chart-multi00"), [{
            data: datas,
            label: "Kraken"
        }, {
            data: datas1,
            label: "Gdax",

        }], {
            xaxes: [{
                 tickDecimals: 0,
            mode: 'time',
            timeformat: "%m/%d/%H:%M",
            unit: 'day',
            ticks: {
                    display: false
                }
            }],
            yaxes: [{
              tickDecimals: 2,
            min: min - ((max - min)/3),
            max: max + ((max - min)/3)

            }, {
                // align if we are to the right
                alignTicksWithAxis: position == "right" ? 1 : null,
                position: position,
                tickFormatter: euroFormatter
            }],
            legend: {
                position: 'sw'
            },
            colors: ["#0073ff"],
            grid: {
                color: "#999999",
                hoverable: true,
                clickable: true,
                tickColor: "#D4D4D4",
                borderWidth:0,
                hoverable: true //IMPORTANT! this is needed for tooltip to work,

            },
            tooltip: true,
            tooltipOpts: {
                content: "x: %x  y: %y",

                onHover: function(flotItem, $tooltipEl) {
                    // console.log(flotItem, $tooltipEl);
                }
            }

        });
    }

    doPlot("right");

    $("button").click(function() {
        doPlot($(this).text());
    });
});

  </script>
<% end %>
